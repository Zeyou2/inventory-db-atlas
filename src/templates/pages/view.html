{% extends "index.html" %}
{% block content %}
<!-- <style>
    body {
        overflow: hidden;
    }
    .table-overflow {
      
      max-height: 100%;
      overflow-x: auto;
      overflow-y:hidden;
      border: 1px solid #c20909;
    }
    .box {
        display: flex;
    }
  </style> -->
<div class="container-fluid" style="background-color: #777875; border-style: solid; border-color: rgb(10, 255, 59);" >
    <div class="page-header bm-1" style="background-color: #777875; border-style: solid; border-color: rgb(215, 2, 2);">
        <h1 class="text-center m-4" style="color: white; text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black;" > collection_name</h1>
        <div class="row mb-3 justify-content-center align-items-center " style="border-style: solid; border-color: rgb(29, 7, 193);">
            <div class="col-10" style="border-style: solid; border-color: rgb(29, 172, 67);">
                <input type="text" id="searchInput" class="form-control" placeholder="Pesquisar em {{ collection_name }}" onkeyup="searchCards()">
                <h4 id="resultsCount" style="color: rgb(0, 0, 0); font-weight: bold; font-size: 18px;"></h4>
            </div>
        </div>
            {% if zipped %}
                <div id="main-content" class="flex-grow-1 p-1 m-3 table-overflow" style="background-color: #777875; border-style: solid; border-color: rgb(84, 0, 239);">
                    <div class="container">
                        <div class="row" id="card-container" style="background-color: #777875; border-style: solid; border-color: rgb(154, 5, 187);">
                            {% for base, category in zipped %}
                                {% if base and category %}
                                    <div class="col-12 mb-4 card-item" style="background-color: #777875; border-style: solid; border-color: rgb(5, 99, 24);">
                                        <div class="card shadow-sm p-4 rounded card-hover" onclick="window.location.href='/cadastro/produtos';"
                                            style="border: 1px solid rgba(104, 88, 88, 0.808); background-color: #B0E0E6; display: flex; flex-direction: row; align-items: center; height: 140px;">
                                                <div class="card-img-left" style="flex-shrink: 0; width: 100px; height: 100px; background-color: #fb0101; border-radius: 50px; border: 1px solid rgba(104, 88, 88, 0.808); overflow: hidden; display: flex; justify-content: center; align-items: center;">
                                                    {% if collection_name == 'pontos' %}
                                                        <img src="{{ url_for('static', filename='images_' + collection_name + '/' + category) }}" alt="Imagem" class="img-fluid" style="object-fit: cover; width: 100%; height: 100%;">
                                                    {% else %}
                                                        <img src="{{ url_for('static', filename='images_' + collection_name + '/icone-' + category) }}" alt="Imagem" class="img-fluid" style="object-fit: cover; width: 100%; height: 100%;">
                                                    {% endif %}
                                                </div>
                                            <div class="card-body d-flex flex-column p-1 position-relative" style="flex-grow: 1; overflow: hidden; max-height: 130px; text-overflow: ellipsis; border-style: solid; border-color: #fb0101;">                                                                                                                       
                                                {% for key, value in base.items() %}
                                                    <div class="card-links position-absolute" style="top: 1px; right: 1px;">
                                                        <a href="/edit_card/{{ collection_name }}/{{ base['Código'] }}" class="btn btn-sm btn-success me-2">Editar</a>
                                                        <a href="/disable_card/{{ collection_name }}/{{ base['Código'] }}" class="btn btn-sm btn-danger" onclick="return confirmarExclusao(event)">Excluir</a>
                                                    </div>
                                                    {% if "_title" in key %}
                                                        <h5 class="card-title" style="font-weight: bold; color: #000000;">
                                                            {{ value }} 
                                                        </h5>
                                                    {% endif %}
                                                {% endfor %}
                                                <table class="table table-borderless text-center" style="height: 100%; table-layout: fixed;">
                                                    <thead>
                                                        <tr class="border align-middle text-center">
                                                            {% for key, value in base.items() %}
                                                                {% if "_title" not in key %}
                                                                    <th class="align-middle" style="font-weight: bold; border: 1px solid #000000; background-color: #E6E6FA;">{{ key }}</th>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="border align-middle text-center">
                                                            {% for key, value in base.items() %}
                                                                {% if "_title" not in key %}
                                                                    <td class="align-middle" style="font-size: small; border: 1px solid #000000;">{{ value[:20] }}{% if value|length > 20 %}...{% endif %}</td>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    {% else %}
                                    {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
      
        {% else %}
            <h2 style="background-color: #07e5da;">A Base de dados {{ title }} está vazia.</h2>
        {% endif %}
            </div>
        </div>
    
    </div>

    {% if collection_name == 'produtos' %}
    <div class="position-sticky" style="border-style: solid; border-color: rgb(255, 174, 0);">
        <div><a class="position-absolute bottom-0 end-0" , style="margin: 0.3%;" href="{{ url_for('operation') }}" >
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z" />
                </svg>
        </div>
        {% endif %}
</div>
    <style>
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-hover:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
    </style>
    <script>
        function searchCards() {
            var input, filter, cards, cardItems, cardTitle, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toLowerCase();
            cards = document.getElementById("card-container");
            cardItems = cards.getElementsByClassName("card-item");
            visibleCount = 0;
        
            for (i = 0; i < cardItems.length; i++) {
                cardTitle = cardItems[i].getElementsByClassName("card-title")[0];
                if (cardTitle) {
                    const txtValue = cardTitle.textContent || cardTitle.innerText;
                    if (txtValue.toLowerCase().indexOf(filter) > -1) {
                        cardItems[i].style.display = "";
                        visibleCount++; 
                    } else {
                        cardItems[i].style.display = "none"; 
                    }
                }
            }
            document.getElementById("resultsCount").textContent = `Resultados exibidos: ${visibleCount}`;
        }
        window.onload = function() {
            searchCards();
        };
        function confirmarExclusao(event) {
            const confirmacao = confirm("Tem certeza que deseja excluir este item?");
            if (!confirmacao) {
                event.preventDefault();
                return false;
            }
            return true;
        }
    </script>
    {% endblock %}
